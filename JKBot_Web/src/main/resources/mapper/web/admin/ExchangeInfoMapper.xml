<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN"
	"https://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="jk.framework.web.admin.mapper.ExchangeInfoMapper">
 	
 	<select id="getAllExchangeInfo" parameterType="PriceExchangeInfoEntity" resultType="PriceExchangeInfoEntity">
		SELECT 
			EXCHANGE_NAME
		   ,COIN_KOR_NAME
		   ,COIN_SYMBOL_NAME
		   ,COIN_EXCHANGE_TYPE
		   ,COIN_TRANS_FEE_KRW
		   ,COIN_PRICE_KRW
		   ,COIN_PRICE_UPDATE_DT
		FROM jk_exchange_info 
		WHERE USE_YN = 'Y'
		<if test="@org.apache.commons.lang3.StringUtils@isNotEmpty(coinSymbolName)">
			AND COIN_SYMBOL_NAME = #{coinSymbolName}
		</if>		
	</select>

	<update id="updateCoinPriceInfo" parameterType="java.util.List">
	    <foreach collection="list" item="entity" index="index" separator=";">
	        UPDATE jk_exchange_info 
	        SET COIN_PRICE_KRW = #{entity.priceKrw},
	        COIN_PRICE_UPDATE_DT = now()
	        WHERE EXCHANGE_NAME = #{entity.exchangeName}
	        AND COIN_SYMBOL_NAME = #{entity.coinSymbol} 
	    </foreach>
	</update>
	
	
	<update id="updateOneBtcCoinPrice" parameterType="PriceCompareEntity">
        UPDATE jk_service_coin_price 
        SET
	        PRICE_KRW_A = #{priceKrwA}
	       ,PRICE_KRW_B = #{priceKrwB}
	       ,PRICE_BTC_B = #{priceBtcB}
	       ,PRICE_USDT_B = #{priceUsdtB}
	       ,PRICE_GAP_KRW = #{priceGapKrw}
	       ,TRANSFER_FEE_A = #{transferFeeA}
	       ,TRANSFER_FEE_B = #{transferFeeB}
	       ,PRICE_GAP_PERCENT = #{priceGapPercent}
           ,UPDATE_DT = now()
        WHERE  COIN_EXCHANGE_TYPE = 'BTC'
        AND COIN_SYMBOL = #{coinSymbol}
	</update>
	
	<update id="updateBtcCoinPrice" parameterType="java.util.List">
	    <foreach collection="list" item="entity" index="index" separator=";">
	        UPDATE jk_service_coin_price 
	        SET
		        PRICE_KRW_A = #{entity.priceKrwA}
		       ,PRICE_KRW_B = #{entity.priceKrwB}
		       ,PRICE_BTC_B = #{entity.priceBtcB}
		       ,PRICE_USDT_B = #{entity.priceUsdtB}
		       ,PRICE_GAP_KRW = #{entity.priceGapKrw}
		       ,TRANSFER_FEE_A = #{entity.transferFeeA}
		       ,TRANSFER_FEE_B = #{entity.transferFeeB}
		       ,PRICE_GAP_PERCENT = #{entity.priceGapPercent}
	           ,UPDATE_DT = now()
	        WHERE  COIN_EXCHANGE_TYPE = 'BTC'
	        AND COIN_SYMBOL = #{entity.coinSymbol}
	    </foreach>
	</update>
	
	<update id="updateUsdtCoinPrice" parameterType="java.util.List">
	    <foreach collection="list" item="entity" index="index" separator=";">
	        UPDATE jk_service_coin_price 
	        SET
		        PRICE_KRW_A = #{entity.priceKrwA}
		       ,PRICE_KRW_B = #{entity.priceKrwB}
		       ,PRICE_BTC_B = #{entity.priceBtcB}
		       ,PRICE_USDT_B = #{entity.priceUsdtB}
		       ,PRICE_GAP_KRW = #{entity.priceGapKrw}
		       ,TRANSFER_FEE_A = #{entity.transferFeeA}
		       ,TRANSFER_FEE_B = #{entity.transferFeeB}
		       ,PRICE_GAP_PERCENT = #{entity.priceGapPercent}
	           ,UPDATE_DT = now()
	        WHERE COIN_EXCHANGE_TYPE = 'USDT'
	        AND COIN_SYMBOL = #{entity.coinSymbol}
	    </foreach>
	</update>
	
</mapper>
